dist: trusty
sudo: required
git:
  depth: 3
language: php
php:
- '7.1'
cache:
  yarn: true
  directories:
  - "$HOME/.composer/cache"
  - "$HOME/node_modules"
before_install:
- bash .travis.install-mysql-5.7.sh
- cp .env.dusk.travis .env
- nvm install 7.4.0
- nvm use 7.4.0
- npm cache clean
- npm install
- mysql -e 'CREATE DATABASE harvey_dusk;'
before_script:
- export DB_CONNECTION=mysql
- export DB_USERNAME=root
- export DB_DATABASE=harvey_dusk
- export DB_SOCKET=/var/run/mysqld/mysqld.sock
- phpenv config-rm xdebug.ini
- composer self-update
- composer install --no-interaction
- export DISPLAY=:99.0
- /usr/bin/Xvfb :99 -ac -screen 0 2560x1440x24 &
- ./vendor/laravel/dusk/bin/chromedriver-linux --silent &
script:
- php artisan migrate --seed
- php artisan serve --host=localhost --quiet > /dev/null 2>&1 &
- php artisan dusk
- killall -s SIGKILL Xvfb chromedriver-linux php mysqld
- vendor/bin/phpunit
branches:
  only:
  - master
  - develop
  - dusk
  - /^release\//
notifications:
  email: false
  slack:
    rooms:
      secure: IPwRGtt3SVK8MvcVLulMdVOmrCfMly5GZt0YU5L6fmX8AXKRHLj99RwDwJ+pHuFPmrDrxphxaxeBhhf6kzYI4em0MYBaqfsAk0XsdOLY+7WoF/Bu5T1xGKsjgmHQpEzHhwTrghboGoSw3Op2o2x5FgvhMi6Bg03Lmp73As1yB4mIPb6z9x9PxYeS9UNsTBiyyFpV9r7pVLzSMrwKZXfaaaHkKScto0RKcg7aovtKphWlsuxGLOXejcZU9DFV7QBX8oFZmsTc1Qlga/3SD0VjlNU7wlHLTxZR9qWj7pOyssU2XEjCCET77MypifMA/vNysdG/VWturDSSJZ3yeeFpJTbgMwpXK+SYj+2yHc59z9RZFLoQ3nDmopFjsnz04ypcuDWLt6L0pQcOtiVbqcTLJpCTAAvoClMIVIVy9O1xSqj8S3ZIj6rXxVsGxVnlbhNJXKv+aQUrglbSmdlsQmtEz6W1e8x+sqj8WLXUN6WWuxqgOhEDXKvJ6VjWblo2YjKGJMcmSbadsdRO6Px8yMgSUj9d/jz8QcGjo+yb05Omz2YRBpUWnBTCn+p3E7wJFAAi0qtdhdHHqmiBs1+rWRMFrY/r7GTps3bLuI5p5QXOyqdvuTiZtparlGgdWjo8sZRJeJaBVg8rhAxqM9bpuR+NiR+SzqC8RMg8i8n56pVO1dI=
    template:
      - "%{commit_message} on `%{branch}` by %{author}: %{message}"
      - "Elapsed Time: %{elapsed_time}"
      - "Build details: %{build_url}"
